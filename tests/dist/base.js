"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ShaderEdge = exports.ShaderEdgeSlot = exports.ShaderSlot = exports.ShaderSlotType = exports.resetGlobalShaderSlotID = exports.ShaderNode = exports.ConcretePrecisionType = exports.ShaderPropery = void 0;
const utils_1 = require("./utils");
class ShaderPropery {
    constructor(obj) {
        this.type = {};
        this.data = {};
        this.name = '';
        this.node = null;
        this.type = obj.type;
        this.data = utils_1.getJsonObject(obj.JSONnodeData);
        this.name = this.data.m_Name;
        this.name = this.name.replace(/ /g, '_');
    }
    get defaultValue() {
        return this.data.m_Value;
    }
    get concretePrecision() {
        let concretePrecision = 1;
        let value = this.defaultValue;
        if (typeof value === 'object') {
            if (value.w !== undefined || value.r !== undefined) {
                concretePrecision = 4;
            }
            else if (value.z !== undefined || value.g !== undefined) {
                concretePrecision = 3;
            }
            else if (value.y !== undefined || value.b !== undefined) {
                concretePrecision = 2;
            }
        }
        return concretePrecision;
    }
}
exports.ShaderPropery = ShaderPropery;
var ConcretePrecisionType;
(function (ConcretePrecisionType) {
    ConcretePrecisionType[ConcretePrecisionType["Min"] = 0] = "Min";
    ConcretePrecisionType[ConcretePrecisionType["Max"] = 1] = "Max";
    ConcretePrecisionType[ConcretePrecisionType["Fixed"] = 2] = "Fixed";
})(ConcretePrecisionType = exports.ConcretePrecisionType || (exports.ConcretePrecisionType = {}));
class ShaderNode {
    // subgraphNode: SubGraphNode | null = null;
    constructor(data) {
        this.type = {};
        this.data = {};
        this.priority = 0;
        this.uuid = '';
        this.slots = [];
        this.slotsMap = new Map;
        this.deps = [];
        this.depChunks = [];
        this.isMasterNode = false;
        this.concretePrecisionType = ConcretePrecisionType.Min;
        this.type = data.typeInfo;
        this.data = utils_1.getJsonObject(data.JSONnodeData);
        this.uuid = this.data.m_GuidSerialized;
        this.slots = this.data.m_SerializableSlots.map(d => {
            let slot = new ShaderSlot(d, this);
            this.slotsMap.set(slot.id, slot);
            return slot;
        });
    }
    addDependency(dep) {
        if (dep === this) {
            return;
        }
        if (!this.deps.includes(dep)) {
            this.deps.push(dep);
        }
    }
    calcConcretePrecision() {
        if (this.concretePrecisionType !== ConcretePrecisionType.Fixed) {
            let finalPrecision = 1;
            if (this.concretePrecisionType === ConcretePrecisionType.Min) {
                finalPrecision = 999;
                this.inputSlots.forEach(slot => {
                    let concretePrecision = slot.concretePrecision;
                    if (slot.connectSlot) {
                        concretePrecision = slot.connectSlot.concretePrecision;
                    }
                    finalPrecision = Math.min(finalPrecision, concretePrecision);
                });
            }
            else if (this.concretePrecisionType === ConcretePrecisionType.Max) {
                finalPrecision = -999;
                this.inputSlots.forEach(slot => {
                    let concretePrecision = slot.concretePrecision;
                    if (slot.connectSlot) {
                        concretePrecision = slot.connectSlot.concretePrecision;
                    }
                    finalPrecision = Math.max(finalPrecision, concretePrecision);
                });
            }
            else {
                console.error('Not supported ConcretePrecisionType : ' + this.concretePrecisionType);
            }
            this.slots.forEach(slot => {
                slot._concretePrecision = finalPrecision;
            });
        }
    }
    setPriority(priority) {
        this.priority = Math.max(priority, this.priority);
        for (let i = 0; i < this.deps.length; i++) {
            this.deps[i].setPriority(this.priority + 1);
        }
    }
    get outputSlots() {
        return this.slots.filter(s => s.type === ShaderSlotType.Output);
    }
    get inputSlots() {
        return this.slots.filter(s => s.type === ShaderSlotType.Input);
    }
    getSlotWithSlotName(name) {
        return this.slots.find(s => s.displayName === name);
    }
    getOutputSlotWithSlotName(name) {
        return this.outputSlots.find(s => s.displayName === name);
    }
    getOutputVarName(idx) {
        return this.outputSlots[idx].varName;
    }
    getOutputVarDefine(idx) {
        return this.outputSlots[idx].varDefine;
    }
    getInputValue(idx) {
        return this.inputSlots[idx].slotValue;
    }
    generateCode() {
        return '';
    }
}
exports.ShaderNode = ShaderNode;
let _GlobalShaderSlotID_ = 0;
function resetGlobalShaderSlotID() {
    _GlobalShaderSlotID_ = 0;
}
exports.resetGlobalShaderSlotID = resetGlobalShaderSlotID;
var ShaderSlotType;
(function (ShaderSlotType) {
    ShaderSlotType[ShaderSlotType["Input"] = 0] = "Input";
    ShaderSlotType[ShaderSlotType["Output"] = 1] = "Output";
})(ShaderSlotType = exports.ShaderSlotType || (exports.ShaderSlotType = {}));
class ShaderSlot {
    constructor(obj, node) {
        this.typeInfo = {};
        this.data = {};
        this.id = 0;
        this.globalID = 0;
        this.displayName = '';
        this.connectSlots = [];
        this.node = undefined;
        this.type = ShaderSlotType.Input;
        this._concretePrecision = -1;
        this.typeInfo = obj.typeInfo;
        this.data = utils_1.getJsonObject(obj.JSONnodeData);
        this.type = this.data.m_SlotType;
        this.node = node;
        this.id = this.data.m_Id;
        this.globalID = _GlobalShaderSlotID_++;
        this.displayName = this.data.m_DisplayName;
    }
    get connectSlot() {
        return this.connectSlots[0];
    }
    ;
    set connectSlot(v) {
        this.connectSlots.length = 0;
        if (v) {
            this.connectSlots[0] = v;
        }
    }
    get varName() {
        return 'var_' + this.globalID;
    }
    get varDefine() {
        let precision = '';
        if (this.concretePrecision === 1) {
            precision = 'float';
        }
        else if (this.concretePrecision === 2) {
            precision = 'vec2';
        }
        else if (this.concretePrecision === 3) {
            precision = 'vec3';
        }
        else if (this.concretePrecision === 4) {
            precision = 'vec4';
        }
        if (precision) {
            precision += ' ';
        }
        return precision + this.varName;
    }
    get defaultValue() {
        let defaultValue = this.data.m_Value;
        let x = utils_1.getFloatString(defaultValue.x);
        let y = utils_1.getFloatString(defaultValue.y);
        let z = utils_1.getFloatString(defaultValue.z);
        let w = utils_1.getFloatString(defaultValue.w);
        let result = utils_1.getFloatString(defaultValue);
        if (typeof defaultValue === 'object') {
            if (defaultValue.w !== undefined) {
                result = `vec4(${x}, ${y}, ${z}, ${w})`;
            }
            else if (defaultValue.z !== undefined) {
                result = `vec3(${x}, ${y}, ${z})`;
            }
            else if (defaultValue.y !== undefined) {
                result = `vec2(${x}, ${y})`;
            }
        }
        return result;
    }
    get slotValue() {
        var _a;
        let valueConretePresition = this.defaultConcretePrecision;
        let selfConcretePresition = this.concretePrecision;
        let defaultValue = this.data.m_Value;
        let x = utils_1.getValueElementStr(defaultValue, 0);
        let y = utils_1.getValueElementStr(defaultValue, 1);
        let z = utils_1.getValueElementStr(defaultValue, 2);
        let w = utils_1.getValueElementStr(defaultValue, 3);
        if (typeof defaultValue !== 'object') {
            x = utils_1.getFloatString(defaultValue);
        }
        let result = '{{value}}';
        if (selfConcretePresition === 2) {
            result = `vec2({{value}})`;
        }
        else if (selfConcretePresition === 3) {
            result = `vec3({{value}})`;
        }
        else if (selfConcretePresition === 4) {
            result = `vec4({{value}})`;
        }
        let value = '';
        if (!this.connectSlot) {
            if ((_a = this.node) === null || _a === void 0 ? void 0 : _a.isMasterNode) {
                return null;
            }
            valueConretePresition = utils_1.getValueConcretePrecision(defaultValue);
            let values = [x, y, z, w];
            let concreteValues = [];
            for (let i = 0; i < selfConcretePresition; i++) {
                concreteValues.push(values[i] === undefined ? 0 : values[i]);
            }
            value = concreteValues.join(', ');
        }
        else {
            valueConretePresition = this.connectSlot.concretePrecision;
            value = this.connectSlot.varName;
            if (selfConcretePresition !== valueConretePresition) {
                if (selfConcretePresition < valueConretePresition) {
                    if (selfConcretePresition === 1) {
                        value += '.x';
                    }
                    else if (selfConcretePresition === 2) {
                        value += '.xy';
                    }
                    else if (selfConcretePresition === 3) {
                        value += '.xyz';
                    }
                }
                else {
                    if (valueConretePresition !== 1) {
                        let dif = selfConcretePresition - valueConretePresition;
                        let difValues = [];
                        for (let i = 0; i < dif; i++) {
                            difValues.push('0.');
                        }
                        value += ', ' + difValues.join(', ');
                    }
                    // if (dif === 1) {
                    //     value += `, ${x}`;
                    // }
                    // else if (dif === 2) {
                    //     value += `, ${x}, ${y}`;
                    // }
                    // else if (dif === 3) {
                    //     value += `, ${x}, ${y}, ${z}`;
                    // }
                }
            }
        }
        result = result.replace('{{value}}', value);
        return result;
    }
    get defaultConcretePrecision() {
        let concretePrecision = 1;
        let value = this.data.m_Value;
        if (typeof value === 'object') {
            if (value.w !== undefined) {
                concretePrecision = 4;
            }
            else if (value.z !== undefined) {
                concretePrecision = 3;
            }
            else if (value.y !== undefined) {
                concretePrecision = 2;
            }
        }
        return concretePrecision;
    }
    get concretePrecision() {
        if (this._concretePrecision === -1) {
            this._concretePrecision = 1;
            let value = this.data.m_Value;
            if (typeof value === 'object') {
                if (value.w !== undefined) {
                    this._concretePrecision = 4;
                }
                else if (value.z !== undefined) {
                    this._concretePrecision = 3;
                }
                else if (value.y !== undefined) {
                    this._concretePrecision = 2;
                }
            }
        }
        return this._concretePrecision;
    }
}
exports.ShaderSlot = ShaderSlot;
class ShaderEdgeSlot {
    constructor() {
        this.id = 0;
        this.nodeUuid = '';
    }
    set(data) {
        this.id = data.m_SlotId;
        this.nodeUuid = data.m_NodeGUIDSerialized;
    }
}
exports.ShaderEdgeSlot = ShaderEdgeSlot;
class ShaderEdge {
    constructor(data) {
        this.type = {};
        this.data = {};
        this.input = new ShaderEdgeSlot;
        this.output = new ShaderEdgeSlot;
        this.type = data.typeInfo;
        this.data = utils_1.getJsonObject(data.JSONnodeData);
        this.input.set(this.data.m_InputSlot);
        this.output.set(this.data.m_OutputSlot);
    }
}
exports.ShaderEdge = ShaderEdge;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUF3SDtBQUd4SCxNQUFhLGFBQWE7SUFPdEIsWUFBYSxHQUFRO1FBTnJCLFNBQUksR0FBRyxFQUFFLENBQUM7UUFDVixTQUFJLEdBQVEsRUFBRSxDQUFBO1FBRWQsU0FBSSxHQUFHLEVBQUUsQ0FBQztRQUNWLFNBQUksR0FBc0IsSUFBSSxDQUFDO1FBRzNCLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztRQUNyQixJQUFJLENBQUMsSUFBSSxHQUFHLHFCQUFhLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBRTVDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDN0IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELElBQUksWUFBWTtRQUNaLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDN0IsQ0FBQztJQUVELElBQUksaUJBQWlCO1FBQ2pCLElBQUksaUJBQWlCLEdBQUcsQ0FBQyxDQUFDO1FBRTFCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDOUIsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7WUFDM0IsSUFBSSxLQUFLLENBQUMsQ0FBQyxLQUFLLFNBQVMsSUFBSSxLQUFLLENBQUMsQ0FBQyxLQUFLLFNBQVMsRUFBRTtnQkFDaEQsaUJBQWlCLEdBQUcsQ0FBQyxDQUFDO2FBQ3pCO2lCQUNJLElBQUksS0FBSyxDQUFDLENBQUMsS0FBSyxTQUFTLElBQUksS0FBSyxDQUFDLENBQUMsS0FBSyxTQUFTLEVBQUU7Z0JBQ3JELGlCQUFpQixHQUFHLENBQUMsQ0FB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QUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUM7SUFDOUMsQ0FBQztDQUNKO0FBUkQsd0NBUUM7QUFFRCxNQUFhLFVBQVU7SUFPbkIsWUFBYSxJQUFTO1FBTnRCLFNBQUksR0FBRyxFQUFFLENBQUM7UUFDVixTQUFJLEdBQVEsRUFBRSxDQUFBO1FBRWQsVUFBSyxHQUFtQixJQUFJLGNBQWMsQ0FBQztRQUMzQyxXQUFNLEdBQW1CLElBQUksY0FBYyxDQUFDO1FBR3hDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUMxQixJQUFJLENBQUMsSUFBSSxHQUFHLHFCQUFhLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBRTdDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM1QyxDQUFDO0NBQ0o7QUFkRCxnQ0FjQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldEpzb25PYmplY3QsIGdldEZsb2F0U3RyaW5nLCBnZXRWYWx1ZUVsZW1lbnQsIGdldFZhbHVlRWxlbWVudFN0ciwgZ2V0VmFsdWVDb25jcmV0ZVByZWNpc2lvbiB9IGZyb20gXCIuL3V0aWxzXCI7XHJcbmltcG9ydCB7IHJlbGF0aXZlIH0gZnJvbSBcInBhdGhcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTaGFkZXJQcm9wZXJ5IHtcclxuICAgIHR5cGUgPSB7fTtcclxuICAgIGRhdGE6IGFueSA9IHt9XHJcblxyXG4gICAgbmFtZSA9ICcnO1xyXG4gICAgbm9kZTogU2hhZGVyTm9kZSB8IG51bGwgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yIChvYmo6IGFueSkge1xyXG4gICAgICAgIHRoaXMudHlwZSA9IG9iai50eXBlO1xyXG4gICAgICAgIHRoaXMuZGF0YSA9IGdldEpzb25PYmplY3Qob2JqLkpTT05ub2RlRGF0YSk7XHJcblxyXG4gICAgICAgIHRoaXMubmFtZSA9IHRoaXMuZGF0YS5tX05hbWU7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gdGhpcy5uYW1lLnJlcGxhY2UoLyAvZywgJ18nKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGVmYXVsdFZhbHVlICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLm1fVmFsdWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGNvbmNyZXRlUHJlY2lzaW9uICgpIHtcclxuICAgICAgICBsZXQgY29uY3JldGVQcmVjaXNpb24gPSAxO1xyXG5cclxuICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUudyAhPT0gdW5kZWZpbmVkIHx8IHZhbHVlLnIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY29uY3JldGVQcmVjaXNpb24gPSA0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlLnogIT09IHVuZGVmaW5lZCB8fCB2YWx1ZS5nICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbmNyZXRlUHJlY2lzaW9uID0gMztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh2YWx1ZS55ICE9PSB1bmRlZmluZWQgfHwgdmFsdWUuYiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25jcmV0ZVByZWNpc2lvbiA9IDI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjb25jcmV0ZVByZWNpc2lvbjtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGVudW0gQ29uY3JldGVQcmVjaXNpb25UeXBlIHtcclxuICAgIE1pbixcclxuICAgIE1heCxcclxuICAgIEZpeGVkLFxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU2hhZGVyTm9kZSB7XHJcbiAgICB0eXBlID0ge307XHJcbiAgICBkYXRhOiBhbnkgPSB7fVxyXG5cclxuICAgIHByaW9yaXR5ID0gMDtcclxuICAgIHV1aWQgPSAnJztcclxuICAgIHNsb3RzOiBTaGFkZXJTbG90W10gPSBbXTtcclxuICAgIHNsb3RzTWFwOiBNYXA8bnVtYmVyLCBTaGFkZXJTbG90PiA9IG5ldyBNYXA7XHJcblxyXG4gICAgZGVwczogU2hhZGVyTm9kZVtdID0gW11cclxuXHJcbiAgICBkZXBDaHVua3M6IHN0cmluZ1tdID0gW11cclxuXHJcbiAgICBpc01hc3Rlck5vZGUgPSBmYWxzZTtcclxuICAgIGNvbmNyZXRlUHJlY2lzaW9uVHlwZSA9IENvbmNyZXRlUHJlY2lzaW9uVHlwZS5NaW47XHJcblxyXG4gICAgLy8gc3ViZ3JhcGhOb2RlOiBTdWJHcmFwaE5vZGUgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvciAoZGF0YTogYW55KSB7XHJcbiAgICAgICAgdGhpcy50eXBlID0gZGF0YS50eXBlSW5mbztcclxuICAgICAgICB0aGlzLmRhdGEgPSBnZXRKc29uT2JqZWN0KGRhdGEuSlNPTm5vZGVEYXRhKTtcclxuXHJcbiAgICAgICAgdGhpcy51dWlkID0gdGhpcy5kYXRhLm1fR3VpZFNlcmlhbGl6ZWQ7XHJcbiAgICAgICAgdGhpcy5zbG90cyA9IHRoaXMuZGF0YS5tX1NlcmlhbGl6YWJsZVNsb3RzLm1hcChkID0+IHtcclxuICAgICAgICAgICAgbGV0IHNsb3QgPSBuZXcgU2hhZGVyU2xvdChkLCB0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy5zbG90c01hcC5zZXQoc2xvdC5pZCwgc2xvdCk7XHJcbiAgICAgICAgICAgIHJldHVybiBzbG90O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZERlcGVuZGVuY3kgKGRlcCkge1xyXG4gICAgICAgIGlmIChkZXAgPT09IHRoaXMpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuZGVwcy5pbmNsdWRlcyhkZXApKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVwcy5wdXNoKGRlcCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNhbGNDb25jcmV0ZVByZWNpc2lvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29uY3JldGVQcmVjaXNpb25UeXBlICE9PSBDb25jcmV0ZVByZWNpc2lvblR5cGUuRml4ZWQpIHtcclxuICAgICAgICAgICAgbGV0IGZpbmFsUHJlY2lzaW9uOiBudW1iZXIgPSAxO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb25jcmV0ZVByZWNpc2lvblR5cGUgPT09IENvbmNyZXRlUHJlY2lzaW9uVHlwZS5NaW4pIHtcclxuICAgICAgICAgICAgICAgIGZpbmFsUHJlY2lzaW9uID0gOTk5O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pbnB1dFNsb3RzLmZvckVhY2goc2xvdCA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbmNyZXRlUHJlY2lzaW9uID0gc2xvdC5jb25jcmV0ZVByZWNpc2lvbjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2xvdC5jb25uZWN0U2xvdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25jcmV0ZVByZWNpc2lvbiA9IHNsb3QuY29ubmVjdFNsb3QuY29uY3JldGVQcmVjaXNpb247XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGZpbmFsUHJlY2lzaW9uID0gTWF0aC5taW4oZmluYWxQcmVjaXNpb24sIGNvbmNyZXRlUHJlY2lzaW9uKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5jb25jcmV0ZVByZWNpc2lvblR5cGUgPT09IENvbmNyZXRlUHJlY2lzaW9uVHlwZS5NYXgpIHtcclxuICAgICAgICAgICAgICAgIGZpbmFsUHJlY2lzaW9uID0gLTk5OTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRTbG90cy5mb3JFYWNoKHNsb3QgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBjb25jcmV0ZVByZWNpc2lvbiA9IHNsb3QuY29uY3JldGVQcmVjaXNpb247XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNsb3QuY29ubmVjdFNsb3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uY3JldGVQcmVjaXNpb24gPSBzbG90LmNvbm5lY3RTbG90LmNvbmNyZXRlUHJlY2lzaW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBmaW5hbFByZWNpc2lvbiA9IE1hdGgubWF4KGZpbmFsUHJlY2lzaW9uLCBjb25jcmV0ZVByZWNpc2lvbik7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTm90IHN1cHBvcnRlZCBDb25jcmV0ZVByZWNpc2lvblR5cGUgOiAnICsgdGhpcy5jb25jcmV0ZVByZWNpc2lvblR5cGUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnNsb3RzLmZvckVhY2goc2xvdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBzbG90Ll9jb25jcmV0ZVByZWNpc2lvbiA9IGZpbmFsUHJlY2lzaW9uO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRQcmlvcml0eSAocHJpb3JpdHkpIHtcclxuICAgICAgICB0aGlzLnByaW9yaXR5ID0gTWF0aC5tYXgocHJpb3JpdHksIHRoaXMucHJpb3JpdHkpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5kZXBzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVwc1tpXS5zZXRQcmlvcml0eSh0aGlzLnByaW9yaXR5ICsgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldCBvdXRwdXRTbG90cyAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2xvdHMuZmlsdGVyKHMgPT4gcy50eXBlID09PSBTaGFkZXJTbG90VHlwZS5PdXRwdXQpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpbnB1dFNsb3RzICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zbG90cy5maWx0ZXIocyA9PiBzLnR5cGUgPT09IFNoYWRlclNsb3RUeXBlLklucHV0KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTbG90V2l0aFNsb3ROYW1lIChuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc2xvdHMuZmluZChzID0+IHMuZGlzcGxheU5hbWUgPT09IG5hbWUpO1xyXG4gICAgfVxyXG4gICAgZ2V0T3V0cHV0U2xvdFdpdGhTbG90TmFtZSAobmFtZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm91dHB1dFNsb3RzLmZpbmQocyA9PiBzLmRpc3BsYXlOYW1lID09PSBuYW1lKTtcclxuICAgIH1cclxuICAgIGdldE91dHB1dFZhck5hbWUgKGlkeCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm91dHB1dFNsb3RzW2lkeF0udmFyTmFtZTtcclxuICAgIH1cclxuICAgIGdldE91dHB1dFZhckRlZmluZSAoaWR4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3V0cHV0U2xvdHNbaWR4XS52YXJEZWZpbmU7XHJcbiAgICB9XHJcbiAgICBnZXRJbnB1dFZhbHVlIChpZHgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbnB1dFNsb3RzW2lkeF0uc2xvdFZhbHVlO1xyXG4gICAgfVxyXG5cclxuICAgIGdlbmVyYXRlQ29kZSAoKSB7XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG59XHJcblxyXG5sZXQgX0dsb2JhbFNoYWRlclNsb3RJRF8gPSAwO1xyXG5leHBvcnQgZnVuY3Rpb24gcmVzZXRHbG9iYWxTaGFkZXJTbG90SUQgKCkge1xyXG4gICAgX0dsb2JhbFNoYWRlclNsb3RJRF8gPSAwO1xyXG59XHJcblxyXG5leHBvcnQgZW51bSBTaGFkZXJTbG90VHlwZSB7XHJcbiAgICBJbnB1dCxcclxuICAgIE91dHB1dFxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU2hhZGVyU2xvdCB7XHJcbiAgICB0eXBlSW5mbyA9IHt9O1xyXG4gICAgZGF0YTogYW55ID0ge31cclxuXHJcbiAgICBpZCA9IDA7XHJcblxyXG4gICAgZ2xvYmFsSUQgPSAwO1xyXG4gICAgZGlzcGxheU5hbWUgPSAnJztcclxuXHJcbiAgICBnZXQgY29ubmVjdFNsb3QgKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3RTbG90c1swXTtcclxuICAgIH07XHJcbiAgICBzZXQgY29ubmVjdFNsb3QgKHYpIHtcclxuICAgICAgICB0aGlzLmNvbm5lY3RTbG90cy5sZW5ndGggPSAwO1xyXG4gICAgICAgIGlmICh2KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdFNsb3RzWzBdID0gdjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25uZWN0U2xvdHM6IFNoYWRlclNsb3RbXSA9IFtdO1xyXG5cclxuICAgIG5vZGU6IFNoYWRlck5vZGUgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgdHlwZSA9IFNoYWRlclNsb3RUeXBlLklucHV0O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yIChvYmo6IGFueSwgbm9kZTogU2hhZGVyTm9kZSkge1xyXG4gICAgICAgIHRoaXMudHlwZUluZm8gPSBvYmoudHlwZUluZm87XHJcbiAgICAgICAgdGhpcy5kYXRhID0gZ2V0SnNvbk9iamVjdChvYmouSlNPTm5vZGVEYXRhKTtcclxuXHJcbiAgICAgICAgdGhpcy50eXBlID0gdGhpcy5kYXRhLm1fU2xvdFR5cGUgYXMgU2hhZGVyU2xvdFR5cGU7XHJcblxyXG4gICAgICAgIHRoaXMubm9kZSA9IG5vZGU7XHJcblxyXG4gICAgICAgIHRoaXMuaWQgPSB0aGlzLmRhdGEubV9JZDtcclxuICAgICAgICB0aGlzLmdsb2JhbElEID0gX0dsb2JhbFNoYWRlclNsb3RJRF8rKztcclxuICAgICAgICB0aGlzLmRpc3BsYXlOYW1lID0gdGhpcy5kYXRhLm1fRGlzcGxheU5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IHZhck5hbWUgKCkge1xyXG4gICAgICAgIHJldHVybiAndmFyXycgKyB0aGlzLmdsb2JhbElEO1xyXG4gICAgfVxyXG5cclxuICAgIGdldCB2YXJEZWZpbmUgKCkge1xyXG4gICAgICAgIGxldCBwcmVjaXNpb24gPSAnJztcclxuICAgICAgICBpZiAodGhpcy5jb25jcmV0ZVByZWNpc2lvbiA9PT0gMSkge1xyXG4gICAgICAgICAgICBwcmVjaXNpb24gPSAnZmxvYXQnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLmNvbmNyZXRlUHJlY2lzaW9uID09PSAyKSB7XHJcbiAgICAgICAgICAgIHByZWNpc2lvbiA9ICd2ZWMyJztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5jb25jcmV0ZVByZWNpc2lvbiA9PT0gMykge1xyXG4gICAgICAgICAgICBwcmVjaXNpb24gPSAndmVjMyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuY29uY3JldGVQcmVjaXNpb24gPT09IDQpIHtcclxuICAgICAgICAgICAgcHJlY2lzaW9uID0gJ3ZlYzQnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocHJlY2lzaW9uKSB7XHJcbiAgICAgICAgICAgIHByZWNpc2lvbiArPSAnICc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwcmVjaXNpb24gKyB0aGlzLnZhck5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0IGRlZmF1bHRWYWx1ZSAoKSB7XHJcbiAgICAgICAgbGV0IGRlZmF1bHRWYWx1ZSA9IHRoaXMuZGF0YS5tX1ZhbHVlO1xyXG5cclxuICAgICAgICBsZXQgeCA9IGdldEZsb2F0U3RyaW5nKGRlZmF1bHRWYWx1ZS54KTtcclxuICAgICAgICBsZXQgeSA9IGdldEZsb2F0U3RyaW5nKGRlZmF1bHRWYWx1ZS55KTtcclxuICAgICAgICBsZXQgeiA9IGdldEZsb2F0U3RyaW5nKGRlZmF1bHRWYWx1ZS56KTtcclxuICAgICAgICBsZXQgdyA9IGdldEZsb2F0U3RyaW5nKGRlZmF1bHRWYWx1ZS53KTtcclxuXHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IGdldEZsb2F0U3RyaW5nKGRlZmF1bHRWYWx1ZSk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBkZWZhdWx0VmFsdWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGlmIChkZWZhdWx0VmFsdWUudyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBgdmVjNCgke3h9LCAke3l9LCAke3p9LCAke3d9KWA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZGVmYXVsdFZhbHVlLnogIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gYHZlYzMoJHt4fSwgJHt5fSwgJHt6fSlgO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGRlZmF1bHRWYWx1ZS55ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGB2ZWMyKCR7eH0sICR7eX0pYDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgc2xvdFZhbHVlICgpIHtcclxuICAgICAgICBsZXQgdmFsdWVDb25yZXRlUHJlc2l0aW9uID0gdGhpcy5kZWZhdWx0Q29uY3JldGVQcmVjaXNpb247XHJcbiAgICAgICAgbGV0IHNlbGZDb25jcmV0ZVByZXNpdGlvbiA9IHRoaXMuY29uY3JldGVQcmVjaXNpb247XHJcbiAgICAgICAgbGV0IGRlZmF1bHRWYWx1ZSA9IHRoaXMuZGF0YS5tX1ZhbHVlO1xyXG5cclxuICAgICAgICBsZXQgeCA9IGdldFZhbHVlRWxlbWVudFN0cihkZWZhdWx0VmFsdWUsIDApO1xyXG4gICAgICAgIGxldCB5ID0gZ2V0VmFsdWVFbGVtZW50U3RyKGRlZmF1bHRWYWx1ZSwgMSk7XHJcbiAgICAgICAgbGV0IHogPSBnZXRWYWx1ZUVsZW1lbnRTdHIoZGVmYXVsdFZhbHVlLCAyKTtcclxuICAgICAgICBsZXQgdyA9IGdldFZhbHVlRWxlbWVudFN0cihkZWZhdWx0VmFsdWUsIDMpO1xyXG5cclxuICAgICAgICBpZiAodHlwZW9mIGRlZmF1bHRWYWx1ZSAhPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgeCA9IGdldEZsb2F0U3RyaW5nKGRlZmF1bHRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgbGV0IHJlc3VsdCA9ICd7e3ZhbHVlfX0nO1xyXG4gICAgICAgIGlmIChzZWxmQ29uY3JldGVQcmVzaXRpb24gPT09IDIpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gYHZlYzIoe3t2YWx1ZX19KWBcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoc2VsZkNvbmNyZXRlUHJlc2l0aW9uID09PSAzKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGB2ZWMzKHt7dmFsdWV9fSlgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHNlbGZDb25jcmV0ZVByZXNpdGlvbiA9PT0gNCkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBgdmVjNCh7e3ZhbHVlfX0pYFxyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdmFsdWUgPSAnJztcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLmNvbm5lY3RTbG90KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm5vZGU/LmlzTWFzdGVyTm9kZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZhbHVlQ29ucmV0ZVByZXNpdGlvbiA9IGdldFZhbHVlQ29uY3JldGVQcmVjaXNpb24oZGVmYXVsdFZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgIGxldCB2YWx1ZXMgPSBbeCwgeSwgeiwgd107XHJcbiAgICAgICAgICAgIGxldCBjb25jcmV0ZVZhbHVlczogYW55W10gPSBbXTtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxmQ29uY3JldGVQcmVzaXRpb247IGkrKykge1xyXG4gICAgICAgICAgICAgICAgY29uY3JldGVWYWx1ZXMucHVzaCh2YWx1ZXNbaV0gPT09IHVuZGVmaW5lZCA/IDAgOiB2YWx1ZXNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhbHVlID0gY29uY3JldGVWYWx1ZXMuam9pbignLCAnKVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFsdWVDb25yZXRlUHJlc2l0aW9uID0gdGhpcy5jb25uZWN0U2xvdC5jb25jcmV0ZVByZWNpc2lvbjtcclxuXHJcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5jb25uZWN0U2xvdC52YXJOYW1lO1xyXG4gICAgICAgICAgICBpZiAoc2VsZkNvbmNyZXRlUHJlc2l0aW9uICE9PSB2YWx1ZUNvbnJldGVQcmVzaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChzZWxmQ29uY3JldGVQcmVzaXRpb24gPCB2YWx1ZUNvbnJldGVQcmVzaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZkNvbmNyZXRlUHJlc2l0aW9uID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9ICcueCc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNlbGZDb25jcmV0ZVByZXNpdGlvbiA9PT0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSArPSAnLnh5JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2VsZkNvbmNyZXRlUHJlc2l0aW9uID09PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlICs9ICcueHl6JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWVDb25yZXRlUHJlc2l0aW9uICE9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkaWYgPSBzZWxmQ29uY3JldGVQcmVzaXRpb24gLSB2YWx1ZUNvbnJldGVQcmVzaXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkaWZWYWx1ZXM6IGFueVtdID0gW11cclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaWY7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmVmFsdWVzLnB1c2goJzAuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgKz0gJywgJyArIGRpZlZhbHVlcy5qb2luKCcsICcpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIChkaWYgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgdmFsdWUgKz0gYCwgJHt4fWA7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGVsc2UgaWYgKGRpZiA9PT0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB2YWx1ZSArPSBgLCAke3h9LCAke3l9YDtcclxuICAgICAgICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZWxzZSBpZiAoZGlmID09PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHZhbHVlICs9IGAsICR7eH0sICR7eX0sICR7en1gO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LnJlcGxhY2UoJ3t7dmFsdWV9fScsIHZhbHVlKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgZGVmYXVsdENvbmNyZXRlUHJlY2lzaW9uICgpIHtcclxuICAgICAgICBsZXQgY29uY3JldGVQcmVjaXNpb24gPSAxO1xyXG5cclxuICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmRhdGEubV9WYWx1ZTtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUudyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25jcmV0ZVByZWNpc2lvbiA9IDQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUueiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25jcmV0ZVByZWNpc2lvbiA9IDM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUueSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb25jcmV0ZVByZWNpc2lvbiA9IDI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBjb25jcmV0ZVByZWNpc2lvbjtcclxuICAgIH1cclxuXHJcbiAgICBfY29uY3JldGVQcmVjaXNpb24gPSAtMTtcclxuICAgIGdldCBjb25jcmV0ZVByZWNpc2lvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2NvbmNyZXRlUHJlY2lzaW9uID09PSAtMSkge1xyXG4gICAgICAgICAgICB0aGlzLl9jb25jcmV0ZVByZWNpc2lvbiA9IDE7XHJcblxyXG4gICAgICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLmRhdGEubV9WYWx1ZTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS53ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb25jcmV0ZVByZWNpc2lvbiA9IDQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZS56ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb25jcmV0ZVByZWNpc2lvbiA9IDM7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZS55ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb25jcmV0ZVByZWNpc2lvbiA9IDI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmNyZXRlUHJlY2lzaW9uO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU2hhZGVyRWRnZVNsb3Qge1xyXG4gICAgaWQgPSAwO1xyXG4gICAgbm9kZVV1aWQgPSAnJztcclxuXHJcbiAgICBzZXQgKGRhdGE6IGFueSkge1xyXG4gICAgICAgIHRoaXMuaWQgPSBkYXRhLm1fU2xvdElkO1xyXG4gICAgICAgIHRoaXMubm9kZVV1aWQgPSBkYXRhLm1fTm9kZUdVSURTZXJpYWxpemVkO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgU2hhZGVyRWRnZSB7XHJcbiAgICB0eXBlID0ge307XHJcbiAgICBkYXRhOiBhbnkgPSB7fVxyXG5cclxuICAgIGlucHV0OiBTaGFkZXJFZGdlU2xvdCA9IG5ldyBTaGFkZXJFZGdlU2xvdDtcclxuICAgIG91dHB1dDogU2hhZGVyRWRnZVNsb3QgPSBuZXcgU2hhZGVyRWRnZVNsb3Q7XHJcblxyXG4gICAgY29uc3RydWN0b3IgKGRhdGE6IGFueSkge1xyXG4gICAgICAgIHRoaXMudHlwZSA9IGRhdGEudHlwZUluZm87XHJcbiAgICAgICAgdGhpcy5kYXRhID0gZ2V0SnNvbk9iamVjdChkYXRhLkpTT05ub2RlRGF0YSk7XHJcblxyXG4gICAgICAgIHRoaXMuaW5wdXQuc2V0KHRoaXMuZGF0YS5tX0lucHV0U2xvdCk7XHJcbiAgICAgICAgdGhpcy5vdXRwdXQuc2V0KHRoaXMuZGF0YS5tX091dHB1dFNsb3QpO1xyXG4gICAgfVxyXG59Il19